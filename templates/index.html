<!DOCTYPE html>
<html lang="en">
<!-- Template Altered from --> 
<head>
<title>Web-based tool to investigate Enhancer Signals</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
  body {font-family: "Lato", sans-serif}
  .mySlides {display: none}

  /* .input-container {
    display: flex;
    align-items: center;
  } */

  /* Style for the error message */
  .error-message {
    display: none; /* Initially hide the error message */
    white-space: nowrap; /* Prevent line breaks */
  }

  /* Style for error messages */
  .red{
    color: red;
  }

  /* Style for non-error messages */
  .green{
    color: green;
  }

</style>
</head>
<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-black w3-card">
    <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="index.html" class="w3-bar-item w3-button w3-padding-large">HOME</a>
    <a href="documentation.html" class="w3-bar-item w3-button w3-padding-large w3-hide-small">DOCUMENTATION</a>
    <a href="run_model.html" class="w3-bar-item w3-button w3-padding-large w3-hide-small">RUN MODEL</a>
    <a href="index.html#registration" class="w3-bar-item w3-button w3-padding-large w3-hide-small">LOGIN/REGISTER</a>
  </div>
</div>

<!-- Page content -->
<div class="w3-content" style="max-width:2000px;margin-top:46px">

 <!-- Welcome Section -->
  <div class="w3-content w3-black w3-center w3-padding-64" id="welcome" style="background-image: url(https://newsroom.unsw.edu.au/sites/default/files/thumbnails/image/unsw_library_lawn_2_0_3.jpg);">
    <div class="w3-container w3-center" id="welcome-page">
      <h2 class="w3-wide" style="font-weight: 500;">EPNET: A Web-based Tool Utilising Deep Neural Network to Predict Significant Enhancer Signals</h2>
      <button class="w3-button w3-light-grey" onclick="location.href = 'run_model.html'">Run Model</button>
      </div>
</div>

 <!-- Introduction Section -->
 <div class="w3-content w3-center w3-padding-64" id="welcome" >
  <div class="w3-container w3-center" id="welcome-page">
    <h2 class="w3-wide" style="font-weight: 500;">Introduction</h2>
    <p>EPNET is a biologically informed deep neural network to predict and interpret enhancer-promoter interactions. Given a set of enhancer and promoter interactions as input, EPNET outputs the pathways and processes associated with the interaction, thus providing insight into underlying biological mechanisms of phenotypes and diseases.</p>
    <p>Authors: Jade Liang, Sally Chen</p>
    <p>Citation</p>
    </div>
</div>

 <!-- The Registration Section -->
  <div class="w3-content w3-black w3-center w3-padding-64" style="max-width:800px" id="registration">
    <h2 class="w3-wide w3-center">Please Login Here</h2>
    <div class="w3-container w3-center">
      <form id="loginForm" onsubmit="checkPassword()">
        <label for="email">Email:</label>
        <input class="w3-border" type="text" id="email-input" name="email-input">
        <label for="password">Password:</label>
        <input class="w3-border" type="password" id="password-input" name="password-input">
        <input class="w3-button w3-light-grey" type="submit" value="Login">
    </form>
      <p>Doesn't have an account? </p>
      <button class="w3-button w3-light-grey" onclick="document.getElementById('registrationModal').style.display='block'">Register Here</button>
      <p id="message-alert"></p>

    </div>
  </div>

  <!-- Javascript for Form Validation (Assignment 3)-->
<script>

// Funtion to validate email address
function validateEmailAddress(input) {
  var emailRegex = /^[\w.-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
  var errorElement = input.nextElementSibling; // Get the error message element
  errorElement.style.display = "inline";
  if (input.value == "") {
    errorElement.textContent = ""
    return false;
  } else if (!emailRegex.test(input.value)) {
    errorElement.textContent = "Email Address is invalid";
    errorElement.className = "error-message red";
    return false;
  } else {
    errorElement.textContent = "No errors";
    errorElement.className = "error-message green"; 
    return true;
  }
}

// Function to validate password
function validatePassword(input) {
  var passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/;
  var errorElement = input.nextElementSibling; // Get the error message element
  errorElement.style.display = "inline";
  if (input.value == "") {
    errorElement.textContent = ""
    return false;
  } else if (!passwordRegex.test(input.value)) {
    errorElement.textContent = "Password must contain 8 characters and include uppercase, lowercase and numbers";
    errorElement.className = "error-message red";
    return false;
  } else {
    errorElement.textContent = "No errors";
    errorElement.className = "error-message green"; 
    return true;
  }
}

// Function to validate re-entered password
function validateReenter(input) {
  var inputElement = document.getElementById("password");
  var errorElement = input.nextElementSibling; // Get the error message element
  errorElement.style.display = "inline";
  if (input.value == "") {
    errorElement.textContent = ""
    return false;
  } else if (input.value != inputElement.value) {
    errorElement.textContent = "Passwords must match";
    errorElement.className = "error-message red";
    return false;
  } else {
    errorElement.textContent = "No errors";
    errorElement.className = "error-message green"; 
    return true;
  }
}

// Function to validate first name
function validateFirstName(input) {
  var firstNameRegex = /^[A-Za-z\s'-]+$/;
  var errorElement = input.nextElementSibling; // Get the error message element
  errorElement.style.display = "inline";
  if (input.value == "") {
    errorElement.textContent = ""
    return false;
  } else if (!firstNameRegex.test(input.value)) {
    errorElement.textContent = "First name should contain only letters, apostrophes, spaces and hyphens";
    errorElement.className = "error-message red";
    return false;
  } else {
    errorElement.textContent = "No errors";
    errorElement.className = "error-message green"; 
    return true;
  }
}

// Function to validate last name 
function validateLastName(input) {
  var lastNameRegex = /^[A-Za-z\s'-]+$/;
  var errorElement = input.nextElementSibling; // Get the error message element
  errorElement.style.display = "inline";
  if (input.value == "") {
    errorElement.textContent = ""
    return false;
  } else if (!lastNameRegex.test(input.value)) {
    errorElement.textContent = "Last name should contain only letters, apostrophes, spaces and hyphens";
    errorElement.className = "error-message red";
    return false;
  } else {
    errorElement.textContent = "No errors";
    errorElement.className = "error-message green"; 
    return true;
  }
}

// Function to convert date from dd/mm/yyyy format to yyy-mm-dd format
function convertDateFormat(inputDate) {
  // Split the input date into day, month, and year parts
  const parts = inputDate.split('/');
  
  const year = parts[2];
  const month = parts[1];
  const day = parts[0];
  
  // Ensure zero-padding for single-digit day and month values
  const formattedDate = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
  
  return formattedDate;
}

// Function to check if date exists, is not a future date, and is not more than 200 years back
function isDateValid(dateString) {
  // Parse the date string into a Date object
  const date = new Date(dateString);

  // Check if the date is valid (not NaN) and is not a future date
  if (isNaN(date.getTime()) || date > new Date()) {
    return false;
  }

  // Calculate a date that is 200 years ago from the current date
  const maxDate = new Date();
  maxDate.setFullYear(maxDate.getFullYear() - 200);
  
  // Check if the date is not more than 200 years in the past
  if (date < maxDate) {
    return false;
  }

  return true;
}

// Function to validate date of birth 
function validateDateOfBirth(input) {
  var dateRegex = /^\d{2}\/\d{2}\/\d{4}$/;
  input.nextElementSibling.style.display = "inline";
  var errorElement = input.nextElementSibling; // Get the error message element
  
  // If no input
  if (input.value == "") {
    errorElement.textContent = ""; 
    return false;
  } else if (!dateRegex.test(input.value)) { // Input exists but not in correct format
    errorElement.textContent = "Invalid DOB";
    errorElement.className = "error-message red";
    return false;
  } 

  // if in correct format, check if date is valid
  var date = convertDateFormat(input.value)
  var isValid = isDateValid(date)

  if (isValid === false) {
    errorElement.textContent = "Invalid DOB";
    errorElement.className = "error-message red";
    return false;
  } else {
    errorElement.textContent = "No errors";
    errorElement.className = "error-message green"; 
    return true;
  }
}

// Function to validate register form
function validateForm(event) {

  // Check if email is valid
  var emailInput = document.getElementById("email");
  var isValidEmail = validateEmailAddress(emailInput); 
  // Check if password is valid 
  var passwordInput = document.getElementById("password");
  var isValidPassword = validatePassword(passwordInput);
  // Check if re-entered password is valid
  var reenterInput = document.getElementById("reenter-password");
  var isValidReenter = validateReenter(reenterInput);
  // Check if first name is valid
  var firstNameInput = document.getElementById("firstname");
  var isValidFirstName = validateFirstName(firstNameInput);
  // Check if last name is valid
  var lastNameInput = document.getElementById("lastname");
  var isValidLastName = validateLastName(lastNameInput);
  // Check if dob is valid 
  var dobInput = document.getElementById("dob");
  var isValidDob = validateDateOfBirth(dobInput);

  var genderInput = document.getElementById("gender");

  var instInput = document.getElementById("institution");

  var specialtiesInput = document.getElementById("specialties");
  
  if (isValidEmail === false ||
    isValidPassword === false ||
    isValidReenter === false ||
    isValidFirstName === false ||
    isValidLastName === false ||
    isValidDob === false
  ) {
    console.log("Something wrong")
    window.alert("Please address the errors and fill out all sections of the form before submitting.");
    return false;
  } else {
    console.log("Nothing wrong")
    event.preventDefault();
    var formData = new FormData(this);
    fetch('/register', {
        method: 'POST',
        body: JSON.stringify({
            email: formData.get('email'),
            password: formData.get('password'),
            first_name: formData.get('firstname'),
            last_name: formData.get('lastname'),
            gender: formData.get('gender'),
            dob: formData.get('dob'),
            institute: formData.get('institute'),
            specialties: formData.get('specialties')
        }),
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
      if (data.redirect) {
            window.location.href = data.redirect;
        } 
      if (data.message) {
          messageContainter = document.getElementById("message-alert");
          messageContainter.textContent = data.message; 
      }
    })
    .catch(error => console.error('Error:', error));
    return true;
  }
}

function checkPassword(event) {
    event.preventDefault();
    var formData = new FormData(this);
    fetch('/login', {
        method: 'POST',
        body: JSON.stringify({
            email: formData.get('email'),
            password: formData.get('password')
        }),
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
      if (data.redirect) {
            window.location.href = data.redirect;
        } 
      if (data.message) {
          messageContainter = document.getElementById("message-alert");
          messageContainter.textContent = data.message; 
      }
    })
    .catch(error => console.error('Error:', error));
    return true;
};

</script>

  <!-- Registration Modal -->
  <div id="registrationModal" class="w3-modal">
    <div class="w3-modal-content w3-animate-top w3-card-4">
      <header class="w3-container w3-light-grey w3-center w3-padding-24">
        <span onclick="document.getElementById('registrationModal').style.display='none'"
       class="w3-button w3-light-grey w3-xlarge w3-display-topright">x</span>
        <h2 class="w3-wide"><i class="fa fa-suitcase w3-margin-right"></i>Registration</h2>
      </header>

      <form id="registrationForm" onsubmit="return validateForm()">
        <div class="w3-container" id="login-info">
          <h4 class="w3-wide">Login Information</h4>
          <p><label>Email Address</label></p>
          <input class="w3-input w3-border" id="email" name="email" type="text" placeholder="Enter Email" required
            onchange="validateEmailAddress(this)">
          <span class="error-message"></span>
          <p><label>Password</label></p>
          <input class="w3-input w3-border" id="password" name="password" type="password" placeholder="Enter password" required
            onchange="validatePassword(this)">
          <span class="error-message"></span>
          <p><label>Re-enter Password</label></p>
          <input class="w3-input w3-border" id="reenter-password" name="reenter-password" type="password" placeholder="Re-enter password" required
            onchange="validateReenter(this)">
          <span class="error-message"></span>
        </div>
        <div class="w3-container" id="personal-info" > 
          <h4 class="w3-wide">Personal Information</h4>
          <p><label>First Name</label></p>
          <input class="w3-input w3-border" id="firstname" name="firstname" type="text" placeholder="First Name" required
            onchange="validateFirstName(this)">
          <span class="error-message"></span>
          <p><label>Last Name</label></p>
          <input class="w3-input w3-border" id="lastname" name="lastname" type="text" placeholder="Last Name" required
            onchange="validateLastName(this)">
          <span class="error-message"></span>
          <p><label>Date of Birth (dd/mm/yyyy)</label></p>
          <input class="w3-input w3-border" id="dob" name="dob" type="text" maxlength="10" placeholder="Enter DOB" required
            onchange="validateDateOfBirth(this)">
          <span class="error-message"></span>
          <p><label for="gender">Gender</label></p>
            <select name="Gender" id="gender">
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
              <option value="not">Prefer Not to Say</option>
            </select>
            <!--Fields that are not required and need to be validated-->
            <p><label>Institution</label></p>
            <input class="w3-input w3-border" id="institution" name="institution" type="text" maxlength="10" placeholder="Enter Institution">
            <p><label>Specialties</label></p>
            <input class="w3-input w3-border" id="specialties" name="specialties" type="text" maxlength="10" placeholder="Enter Specialties">
        </div>
       
        <button class="w3-button w3-block w3-light-grey w3-padding-16 w3-section w3-right" onclick="validateForm()">REGISTER <i class="fa fa-check"></i></button>
        <button class="w3-button w3-red w3-section" onclick="document.getElementById('registrationModal').style.display='none'">Close <i class="fa fa-remove"></i></button>
      </form>
    </div>
  </div>


<!-- Footer -->
<footer class="w3-container w3-padding-64 w3-center w3-opacity w3-light-grey w3-xlarge">
  <div class="w3-row">
    <div class="w3-center w3-large w3-margin-bottom">
      <i class="w3-center">Biomedical Machine Learning Lab (BML)</i><br>
      <i class="w3-center fa fa-map-marker" style="width:30px"></i> 518, Samuels Building, F25, Samuel Terry Ave, Kensington NSW 2052<br>
      <i class="w3-center fa fa-phone" style="width:30px"></i> Phone: +61 123 456 789<br>
      <i class="w3-center fa fa-envelope" style="width:30px"> </i> Email: <a href="healthcodex@gmail.com">healthcodex@gmail.com</a><br>
    </div>
  </div>
</footer>


</body>
</html>